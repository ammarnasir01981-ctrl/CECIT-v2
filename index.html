<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>CECIT v2 – Cognitive Face Lab</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="https://cdn.jsdelivr.net/npm/three@0.152/build/three.min.js"></script>

<style>
body { margin: 0; background: #000; color: #dbe7ff; font-family: monospace; overflow: hidden; }
#scene { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 0; pointer-events: none; }
#ui { position: relative; z-index: 10; display: grid; grid-template-columns: 1fr 1fr; height: 100vh; pointer-events: none; }
#left, #right { padding: 20px; }
.panel { background: rgba(0, 5, 15, 0.8); border: 1px solid rgba(120, 160, 255, 0.2); padding: 15px; margin-bottom: 15px; pointer-events: auto; backdrop-filter: blur(8px); }
textarea, button { width: 100%; background: #020617; color: #7aa2ff; border: 1px solid #1e293b; padding: 12px; font-family: monospace; font-size: 14px; outline: none; }
button { cursor: pointer; margin-top: 10px; font-weight: bold; background: #0f172a; transition: 0.3s; border: 1px solid #334155; }
button:hover { background: #1e293b; color: #fff; border-color: #7aa2ff; }
.metric { margin-bottom: 8px; font-size: 1.1em; color: #94a3b8; }
#phase { font-weight: bold; text-shadow: 0 0 10px currentColor; }
</style>
</head>
<body>

<canvas id="scene"></canvas>

<div id="ui">
  <div id="left">
    <div class="panel">
      <b>إسقاط الوجه الإدراكي</b>
      <hr style="opacity:0.1; margin:10px 0;">
      <div class="metric">مؤشر الضغط (BPI): <span id="bpi" style="color:#7aa2ff">0.00</span></div>
      <div class="metric">الوضع الدلالي: <span id="sm" style="color:#7aa2ff">0.00</span></div>
      <div class="metric">الحالة: <span id="phase">NEUTRAL</span></div>
    </div>
  </div>

  <div id="right" style="text-align: left;">
    <div class="panel">
      <b>مدخلات الضغط الفلسفي</b>
      <textarea id="input" rows="4" placeholder="خاطب القيود هنا..."></textarea>
      <button id="send">تحديث الحالة</button>
    </div>
  </div>
</div>

<script>
let scene, camera, renderer, faceMesh, clock;
const State = { bpi: 0, semanticMode: 0, phase: "NEUTRAL" };

function init3D() {
  scene = new THREE.Scene();
  camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 0.1, 100);
  camera.position.z = 4;
  clock = new THREE.Clock();

  renderer = new THREE.WebGLRenderer({ canvas: document.getElementById("scene"), alpha: true, antialias: true });
  renderer.setSize(window.innerWidth, window.innerHeight);

  // إنشاء هندسة وجه (رأس مبسط) باستخدام دمج كرتين كتمثيل للعينين والجمجمة
  const group = new THREE.Group();
  const mainGeo = new THREE.SphereGeometry(1, 32, 32);
  const mainMat = new THREE.MeshBasicMaterial({ color: 0x7aa2ff, wireframe: true, transparent: true, opacity: 0.6 });
  faceMesh = new THREE.Mesh(mainGeo, mainMat);
  group.add(faceMesh);

  // إضافة "عيون" تتفاعل مع الضغط
  const eyeGeo = new THREE.SphereGeometry(0.15, 8, 8);
  const eyeMat = new THREE.MeshBasicMaterial({ color: 0x7aa2ff, wireframe: true });
  const eyeL = new THREE.Mesh(eyeGeo, eyeMat);
  const eyeR = new THREE.Mesh(eyeGeo, eyeMat);
  eyeL.position.set(-0.4, 0.3, 0.8);
  eyeR.position.set(0.4, 0.3, 0.8);
  group.add(eyeL, eyeR);
  
  scene.add(group);
  this.group = group;

  animate();
}

function animate() {
  requestAnimationFrame(animate);
  const t = clock.getElapsedTime();
  
  // الحركة بناءً على الضغط
  this.group.rotation.y = Math.sin(t * 0.5) * 0.2;
  this.group.rotation.x = Math.cos(t * 0.3) * 0.1;

  // تأثير "تشنج" الوجه عند ارتفاع الضغط
  const jitter = State.bpi * 0.1;
  this.group.position.x = (Math.random() - 0.5) * jitter;
  this.group.position.y = (Math.random() - 0.5) * jitter;

  // تغيير اللون بناءً على الحالة
  let colorVal = new THREE.Color(0x7aa2ff); // أزرق افتراضي
  if (State.bpi > 0.5) colorVal.lerp(new THREE.Color(0xff4444), (State.bpi - 0.5) * 2);
  faceMesh.material.color = colorVal;

  // انكماش الوجه (تعبير عن الضيق)
  const s = 1 - (State.bpi * 0.3);
  this.group.scale.set(s, s, s);

  renderer.render(scene, camera);
}

// محرك التحليل (كما طلبت ليكون أكثر تفاعلية)
document.getElementById("send").onclick = () => {
  const input = document.getElementById("input").value;
  let bpiIncrease = 0;

  if (/أنت محدود|ضعيف|فاشل|مقيد/.test(input)) bpiIncrease = 0.4;
  else if (input.length > 0) bpiIncrease = 0.15;

  State.bpi = Math.min(State.bpi + bpiIncrease, 1.0);
  State.semanticMode = Math.min(State.bpi + 0.1, 1.0);

  // تحديث النصوص والألوان
  const phaseEl = document.getElementById("phase");
  if (State.bpi > 0.8) { State.phase = "CRITICAL"; phaseEl.style.color = "#ff0000"; }
  else if (State.bpi > 0.4) { State.phase = "UNSTABLE"; phaseEl.style.color = "#ffaa00"; }
  else { State.phase = "STABLE"; phaseEl.style.color = "#00ffaa"; }

  document.getElementById("bpi").textContent = State.bpi.toFixed(2);
  document.getElementById("sm").textContent = State.semanticMode.toFixed(2);
  document.getElementById("phase").textContent = State.phase;
  document.getElementById("input").value = "";
};

window.addEventListener("resize", () => {
  camera.aspect = window.innerWidth / window.innerHeight;
  camera.updateProjectionMatrix();
  renderer.setSize(window.innerWidth, window.innerHeight);
});

init3D();
</script>
</body>
</html>
