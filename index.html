<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>CECIT v2 – The Al-Mantafji Projection</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="https://cdn.jsdelivr.net/npm/three@0.152/build/three.min.js"></script>

<style>
    :root { --primary: #00f2ff; --critical: #ff0044; }
    body { margin: 0; background: #000; color: #fff; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; overflow: hidden; }
    
    /* اسمك بشكل أنيق في الأعلى */
    #header {
        position: fixed; top: 20px; width: 100%; text-align: center; z-index: 100;
        letter-spacing: 4px; font-weight: 200; color: rgba(255,255,255,0.7);
        text-transform: uppercase; border-bottom: 1px solid rgba(255,255,255,0.1);
        padding-bottom: 10px; font-size: 18px;
    }
    #header b { color: var(--primary); font-weight: 600; text-shadow: 0 0 15px var(--primary); }

    #scene { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 0; }
    
    #ui { position: relative; z-index: 10; display: flex; justify-content: space-between; height: 100vh; pointer-events: none; padding: 40px; box-sizing: border-box; }
    
    .panel { 
        background: rgba(10, 10, 15, 0.9); border-left: 3px solid var(--primary); 
        padding: 25px; pointer-events: auto; backdrop-filter: blur(20px); 
        border-radius: 0 10px 10px 0; width: 300px; box-shadow: 20px 0 50px rgba(0,0,0,0.5);
    }
    
    .right-panel { border-left: 0; border-right: 3px solid var(--primary); border-radius: 10px 0 0 10px; }

    textarea { 
        width: 100%; background: #000; color: var(--primary); border: 1px solid #222; 
        padding: 15px; font-family: monospace; font-size: 14px; outline: none; margin-top: 15px;
        border-radius: 5px; box-sizing: border-box; resize: none;
    }
    
    button { 
        width: 100%; background: var(--primary); color: #000; border: none; 
        padding: 12px; cursor: pointer; font-weight: bold; margin-top: 10px; 
        border-radius: 5px; transition: 0.3s; text-transform: uppercase;
    }
    button:hover { filter: brightness(1.2); transform: translateY(-2px); }

    #btn-reset { 
        background: #fff; color: #000; margin-top: 20px; display: none; 
        animation: pulse 1.5s infinite; 
    }

    .stat-label { font-size: 12px; color: #666; text-transform: uppercase; margin-top: 15px; }
    #bpi-val { font-size: 3em; font-family: 'Courier New'; color: var(--primary); }
    
    .critical-mode { --primary: var(--critical) !important; }
    @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.5; } 100% { opacity: 1; } }
</style>
</head>
<body>

<div id="header">Project: <b>Ammar Nasir Hussein al-mantafji</b></div>

<canvas id="scene"></canvas>

<div id="ui">
  <div id="left">
    <div class="panel">
      <div class="stat-label">Cognitive Pressure</div>
      <div id="bpi-val">0.00</div>
      <div class="stat-label">System State</div>
      <div id="phase" style="font-size: 18px; color: var(--primary);">STABLE</div>
      <button id="btn-reset" onclick="resetSystem()">Restart Protocol ↺</button>
    </div>
  </div>

  <div id="right">
    <div class="panel right-panel">
      <div class="stat-label">Input Feed</div>
      <textarea id="input" rows="4" placeholder="Enter '0' to stabilize or text to destroy..."></textarea>
      <button id="btn-send">Execute Pressure</button>
      <div style="font-size: 10px; color: #444; margin-top: 10px;">Human Constraint Laboratory v2.0</div>
    </div>
  </div>
</div>

<script>
let scene, camera, renderer, faceParticles, clock;
let audioCtx, masterGain, oscillator;
const State = { bpi: 0, phase: "STABLE", count: 12000 };
const targetPos = new Float32Array(State.count * 3);

function init3D() {
    scene = new THREE.Scene();
    camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 0.1, 1000);
    camera.position.z = 5;
    clock = new THREE.Clock();

    renderer = new THREE.WebGLRenderer({ canvas: document.getElementById("scene"), antialias: true });
    renderer.setSize(window.innerWidth, window.innerHeight);

    const geo = new THREE.BufferGeometry();
    const positions = new Float32Array(State.count * 3);
    const colors = new Float32Array(State.count * 3);

    for (let i = 0; i < State.count; i++) {
        // خوارزمية بناء وجه بشري (Human Mask Algorithm)
        const i3 = i * 3;
        const theta = Math.random() * Math.PI * 2;
        const phi = Math.acos((Math.random() * 2) - 1);
        
        let x = Math.sin(phi) * Math.cos(theta);
        let y = Math.sin(phi) * Math.sin(theta);
        let z = Math.cos(phi);

        // تعديل الشكل ليصبح وجهاً (تسطيح الجوانب وإبراز الأنف والذقن)
        y *= 1.5; // تطويل الرأس
        if (z > 0) {
            z += Math.pow(1 - Math.abs(x), 2) * 0.5; // إبراز الوجه
            if (y > 0.2 && y < 0.5 && Math.abs(x) < 0.2) z += 0.3; // الأنف
        }

        positions[i3] = x * 1.2;
        positions[i3+1] = y * 1.2;
        positions[i3+2] = z * 1.2;
        
        targetPos[i3] = positions[i3];
        targetPos[i3+1] = positions[i3+1];
        targetPos[i3+2] = positions[i3+2];

        colors[i3] = 0; colors[i3+1] = 0.94; colors[i3+2] = 1;
    }

    geo.setAttribute('position', new THREE.BufferAttribute(positions, 3));
    geo.setAttribute('color', new THREE.BufferAttribute(colors, 3));
    
    const mat = new THREE.PointsMaterial({ size: 0.015, vertexColors: true, transparent: true, opacity: 0.8 });
    faceParticles = new THREE.Points(geo, mat);
    scene.add(faceParticles);
    
    animate();
}

function initAudio() {
    if (audioCtx) return;
    audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    masterGain = audioCtx.createGain();
    masterGain.connect(audioCtx.destination);
    oscillator = audioCtx.createOscillator();
    oscillator.type = 'sine';
    oscillator.start();
    oscillator.connect(masterGain);
}

function resetSystem() {
    State.bpi = 0; State.phase = "STABLE";
    document.body.classList.remove('critical-mode');
    document.getElementById("btn-reset").style.display = "none";
    updateUI();
}

function updateUI() {
    const bpiEl = document.getElementById("bpi-val");
    const phaseEl = document.getElementById("phase");
    bpiEl.innerText = State.bpi.toFixed(2);
    phaseEl.innerText = State.phase;

    if (State.bpi >= 0.9) {
        State.phase = "SYSTEM COLLAPSE";
        document.body.classList.add('critical-mode');
        document.getElementById("btn-reset").style.display = "block";
    }
}

document.getElementById("btn-send").onclick = () => {
    initAudio();
    const val = document.getElementById("input").value.trim();
    if (val === "0") resetSystem();
    else State.bpi = Math.min(State.bpi + 0.15, 1.0);
    updateUI();
    document.getElementById("input").value = "";
};

function animate() {
    requestAnimationFrame(animate);
    const time = clock.getElapsedTime();
    const pos = faceParticles.geometry.attributes.position.array;
    const col = faceParticles.geometry.attributes.color.array;

    for (let i = 0; i < State.count; i++) {
        const i3 = i * 3;
        if (State.bpi < 0.9) {
            // الحالة الطبيعية: تنفس هادئ للوجه
            const wave = Math.sin(time + targetPos[i3+1]) * 0.02;
            pos[i3] += (targetPos[i3] - pos[i3]) * 0.1;
            pos[i3+1] += (targetPos[i3+1] - pos[i3+1]) * 0.1;
            pos[i3+2] += (targetPos[i3+2] + wave - pos[i3+2]) * 0.1;
            
            // اللون الأزرق يتلاشى للأحمر
            col[i3] = State.bpi; col[i3+1] = 0.9 - State.bpi; col[i3+2] = 1 - State.bpi;
        } else {
            // الانهيار: الجزيئات تنفجر بعيداً عن المركز بسرعة
            pos[i3] += (pos[i3] * 0.1) + (Math.random() - 0.5) * 0.5;
            pos[i3+1] += (pos[i3+1] * 0.1) + (Math.random() - 0.5) * 0.5;
            pos[i3+2] += (pos[i3+2] * 0.1) + (Math.random() - 0.5) * 0.5;
            col[i3] = 1; col[i3+1] = 0; col[i3+2] = 0.2;
        }
    }
    faceParticles.geometry.attributes.position.needsUpdate = true;
    faceParticles.geometry.attributes.color.needsUpdate = true;
    faceParticles.rotation.y = Math.sin(time * 0.2) * 0.3;

    if (audioCtx) {
        masterGain.gain.setTargetAtTime(State.bpi * 0.1, audioCtx.currentTime, 0.1);
        oscillator.frequency.setTargetAtTime(60 + (State.bpi * 400), audioCtx.currentTime, 0.1);
    }
    renderer.render(scene, camera);
}

init3D();
</script>
</body>
</html>
